---
title: ã€EC-CUBE4.3ã€‘mock-package-apiã§ã€Œ/packages.jsonã€ãŒ500ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹åŸå› ã¨è§£æ±ºæ–¹æ³•
tags:
  - PHP
  - EC-CUBE4
private: false
updated_at: '2025-04-22T10:06:18+09:00'
id: 00c3720e71e06f64c528
organization_url_name: null
slide: false
ignorePublish: false
---
EC-CUBEã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–‹ç™ºã§ `mock-package-api` ã‚’ä½¿ã£ã¦ã€ãƒ­ãƒ¼ã‚«ãƒ«ã«ç½®ã„ãŸ `.tgz` ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ `/packages.json` ã§èª­ã¿è¾¼ã¾ã›ã‚ˆã†ã¨ã—ãŸã¨ã“ã‚ã€500ã‚¨ãƒ©ãƒ¼ã§ã¤ã¾ãšã„ãŸã®ã§åŸå› ã¨å¯¾å‡¦æ³•ã‚’å…±æœ‰ã—ã¾ã™ã€‚

---

## ğŸ’¥ èµ·ããŸå•é¡Œ

ä»¥ä¸‹ã®ã‚ˆã†ã« `mock-package-api` ã‚’èµ·å‹•ã—ãŸå¾Œâ€¦

```bash
docker run -d --rm \
  -v $(pwd)/repos:/repos \
  -e MOCK_REPO_DIR=/repos \
  -p 9999:8080 \
  eccube/mock-package-api
```

`http://host.docker.internal:9999/packages.json` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ã“ã‚“ãªã‚¨ãƒ©ãƒ¼ãŒè¿”ã£ã¦ãã¾ã—ãŸã€‚

```json
{
  "status": 500,
  "error": "Internal Server Error",
  "message": "Could not read from \"tgz:file:///repos/OrderInquiry.tgz!/composer.json\" because it is not a file."
}
```

---

## ğŸ” åŸå› 

`.tgz` ã®ä¸­ã®æ§‹é€ ãŒ **ã€Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã”ã¨åœ§ç¸®ã€ã•ã‚Œã¦ã„ãŸ** ãŸã‚ã€  
mock-package-api ãŒæ¢ã™ `composer.json` ã®ä½ç½®ã¨ã‚ºãƒ¬ã¦ã„ãŸã€‚

### âŒ NGãªæ§‹é€ ï¼ˆ`tar -tzf` ã®çµæœï¼‰

```
OrderInquiry/
OrderInquiry/composer.json
OrderInquiry/...
```

mock-package-api ã¯ `OrderInquiry.tgz!/composer.json` ã‚’æ¢ã™ãŸã‚ã€  
**ã“ã®æ§‹é€ ã ã¨è¦‹ã¤ã‘ã‚‰ã‚Œãšã« 500 ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚**

---

## âœ… æ­£ã—ã„æ§‹é€ ï¼ˆflatæ§‹é€ ï¼‰

ä»¥ä¸‹ã®ã‚ˆã†ã« `.tgz` ã®ä¸­ã« `composer.json` ãŒ **ç›´ã«å­˜åœ¨**ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### âœ… OKãªæ§‹é€ 

```
composer.json
PluginManager.php
Resource/config/plugin.yml
...
```

---

## ğŸ›  è§£æ±ºæ–¹æ³•ï¼šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸­èº«ã ã‘ã‚’åœ§ç¸®

```bash
# plugins ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã® OrderInquiry ã®ä¸­ã«ç§»å‹•
cd app/Plugin/OrderInquiry

# repos ãƒ•ã‚©ãƒ«ãƒ€ãŒãªã‘ã‚Œã°ä½œã‚‹
mkdir -p ../../repos

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ãªãã€Œä¸­èº«ã€ã ã‘ã‚’åœ§ç¸®
tar --exclude-vcs -czvf ../../repos/OrderInquiry.tgz *
```

---

## ğŸš€ å†ç¢ºèª

```bash
curl http://host.docker.internal:9999/packages.json
```

ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã£ã¦ãã‚Œã°æˆåŠŸï¼

```json
{
  "OrderInquiry": {
    "version": "1.0.0",
    "file": "/OrderInquiry.tgz"
  }
}
```

---

## ğŸ“Œ è£œè¶³

- `composer.json` ã«ã¯æœ€ä½é™ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæƒ…å ±ãŒå¿…è¦ã§ã™ï¼š

```json
{
  "type": "eccube-plugin",
  "extra": {
    "code": "OrderInquiry",
    "version": "1.0.0"
  }
}
```

- `plugin.yml` ã¯ mock-package-api ã®å‹•ä½œã«ã¯å¿…é ˆã§ã¯ãªã„ãŒã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å®šç¾©ã¨ã—ã¦ã¯ã‚ã£ãŸæ–¹ãŒã‚ˆã„

---

## ğŸ™ ã¾ã¨ã‚

- `.tgz` ã®ä¸­èº«ã¯ã€Œ1éšå±¤ã«ã¾ã¨ã‚ãªã„ã¨ã„ã‘ãªã„ã€
- `mock-package-api` ã¯ `.tgz` ã®ç›´ä¸‹ã« `composer.json` ãŒã‚ã‚‹å‰æã§å‹•ã
- `tar` ã‚³ãƒãƒ³ãƒ‰ã§ä¸­èº«ã ã‘ã‚’åœ§ç¸®ã™ã‚Œã°è§£æ±ºï¼

---

## ğŸ”— å‚è€ƒ

- [EC-CUBEãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä»•æ§˜](https://doc4.ec-cube.net/plugin_spec)

---

ã¡ã‚ƒã‚“ã¨å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã¦ã„ãªã‹ã£ãŸã®ãŒåŸå› ã§ã™ãŒã€ä¸‡ãŒä¸€åŒã˜ã¨ã“ã‚ã§ãƒãƒã£ãŸæ–¹ã®å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ ğŸ™Œ

â€» ã“ã®æŠ•ç¨¿ã¯ã€ChatGPTã«ã²ãªå‹ã‚’ä½œã£ã¦ã‚‚ã‚‰ã£ã¦ã¾ã™ã€‚
