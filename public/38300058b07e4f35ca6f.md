---
title: 【EC-CUBE4.3】プラグインを開発してみる その５
tags:
  - PHP
  - Symfony
  - doctrine
  - twig
  - EC-CUBE4
private: false
updated_at: '2025-04-21T15:14:09+09:00'
id: 38300058b07e4f35ca6f
organization_url_name: null
slide: false
ignorePublish: false
---
## 本記事で分かること
- プラグインでのイベントリスナーの使い方

## 手順
### 1. イベントリスナーで`order_no`をフォームにセット
- 現時点だと、受注問合せボタンを押しても、問い合わせフォームの受注番号が空のまま。
```php
namespace Plugin\OrderInquiry\EventListener;

use Doctrine\ORM\EntityManagerInterface;
use Eccube\Event\EccubeEvents;
use Eccube\Event\EventArgs;
use Symfony\Component\EventDispatcher\EventSubscriberInterface;

class ContactFormInitializeListener implements EventSubscriberInterface
{
    public static function getSubscribedEvents()
    {
        return [
            EccubeEvents::FRONT_CONTACT_INDEX_INITIALIZE => 'addOrderNoField',
        ];
    }

    public function addOrderNoField(EventArgs $event)
    {
        $builder = $event->getArgument('builder');
        $request = $event->getRequest();

        $orderNo = $request->query->get('order_no');

        if (!$orderNo) {
            return;
        }

        $data = $builder->getData() ?? [];
        $data['order_no'] = $orderNo;
        $builder->setData($data);
    }
}
```
イベントリスナーは、プラグインでも通常の使い方と同じ。

### 2. 実際に確認してみる
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3850968/245eb2bf-a1a3-4322-aac6-701a8981fdc0.png)
- 注文番号がセットされるようになった
